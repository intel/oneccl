

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Unordered collectives support &mdash; oneCCL Documentation (Beta) 2.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_tabs/tabs.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Sparse collective operations" href="sparse_collectives.html" />
    <link rel="prev" title="Fusion of Communication Operations" href="operation_fusion.html" />
    <link href="_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> oneCCL Documentation (Beta)
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installation-using-command-line-interface">Installation using Command Line Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="installation.html#custom-installation">Custom Installation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installation-using-tar-gz">Installation using tar.gz</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installation-using-rpm">Installation using RPM</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sample.html">Sample Application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="sample.html#build-details">Build details</a></li>
<li class="toctree-l2"><a class="reference internal" href="sample.html#run-the-sample">Run the sample</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Programming Model</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="specification.html">Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="host_communication.html">Host Communication</a><ul>
<li class="toctree-l2"><a class="reference internal" href="host_communication.html#example">Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="device_communication.html">Device Communication</a><ul>
<li class="toctree-l2"><a class="reference internal" href="device_communication.html#example">Example</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">General Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="operation_execution.html">Execution of Communication Operations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="operation_execution.html#explicit-setup">Explicit setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="operation_execution.html#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="operation_execution.html#automatic-setup">Automatic setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="operation_execution.html#id1">Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="transport_selection.html">Transport selection</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced Configuration</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="collective_algorithms_selection.html">Selection of Collective Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="operation_caching.html">Caching of Communication Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="operation_prioritization.html">Prioritization of Communication Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="operation_fusion.html">Fusion of Communication Operations</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Unordered collectives support</a></li>
<li class="toctree-l1"><a class="reference internal" href="sparse_collectives.html">Sparse collective operations</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference Materials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="env_variables.html">Environment Variables</a><ul>
<li class="toctree-l2"><a class="reference internal" href="env_variables.html#collective-algorithms-selection">Collective algorithms selection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="env_variables.html#ccl-coll-name">CCL_&lt;coll_name&gt;</a><ul>
<li class="toctree-l4"><a class="reference internal" href="env_variables.html#example">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="env_variables.html#available-collectives">Available collectives</a></li>
<li class="toctree-l3"><a class="reference internal" href="env_variables.html#available-algorithms">Available algorithms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="env_variables.html#allgatherv-algorithms"><code class="docutils literal notranslate"><span class="pre">ALLGATHERV</span></code> algorithms</a></li>
<li class="toctree-l4"><a class="reference internal" href="env_variables.html#allreduce-algorithms"><code class="docutils literal notranslate"><span class="pre">ALLREDUCE</span></code> algorithms</a></li>
<li class="toctree-l4"><a class="reference internal" href="env_variables.html#alltoall-algorithms"><code class="docutils literal notranslate"><span class="pre">ALLTOALL</span></code> algorithms</a></li>
<li class="toctree-l4"><a class="reference internal" href="env_variables.html#alltoallv-algorithms"><code class="docutils literal notranslate"><span class="pre">ALLTOALLV</span></code> algorithms</a></li>
<li class="toctree-l4"><a class="reference internal" href="env_variables.html#barrier-algorithms"><code class="docutils literal notranslate"><span class="pre">BARRIER</span></code> algorithms</a></li>
<li class="toctree-l4"><a class="reference internal" href="env_variables.html#bcast-algorithms"><code class="docutils literal notranslate"><span class="pre">BCAST</span></code> algorithms</a></li>
<li class="toctree-l4"><a class="reference internal" href="env_variables.html#reduce-algorithms"><code class="docutils literal notranslate"><span class="pre">REDUCE</span></code> algorithms</a></li>
<li class="toctree-l4"><a class="reference internal" href="env_variables.html#reduce-scatter-algorithms"><code class="docutils literal notranslate"><span class="pre">REDUCE_SCATTER</span></code> algorithms</a></li>
<li class="toctree-l4"><a class="reference internal" href="env_variables.html#sparse-allreduce-algorithms"><code class="docutils literal notranslate"><span class="pre">SPARSE_ALLREDUCE</span></code> algorithms</a></li>
<li class="toctree-l4"><a class="reference internal" href="env_variables.html#ccl-rs-chunk-count">CCL_RS_CHUNK_COUNT</a></li>
<li class="toctree-l4"><a class="reference internal" href="env_variables.html#ccl-rs-min-chunk-size">CCL_RS_MIN_CHUNK_SIZE</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="env_variables.html#fusion">Fusion</a><ul>
<li class="toctree-l3"><a class="reference internal" href="env_variables.html#ccl-fusion">CCL_FUSION</a></li>
<li class="toctree-l3"><a class="reference internal" href="env_variables.html#ccl-fusion-bytes-threshold">CCL_FUSION_BYTES_THRESHOLD</a></li>
<li class="toctree-l3"><a class="reference internal" href="env_variables.html#ccl-fusion-count-threshold">CCL_FUSION_COUNT_THRESHOLD</a></li>
<li class="toctree-l3"><a class="reference internal" href="env_variables.html#ccl-fusion-cycle-ms">CCL_FUSION_CYCLE_MS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="env_variables.html#ccl-atl-transport">CCL_ATL_TRANSPORT</a></li>
<li class="toctree-l2"><a class="reference internal" href="env_variables.html#ccl-unordered-coll">CCL_UNORDERED_COLL</a></li>
<li class="toctree-l2"><a class="reference internal" href="env_variables.html#ccl-priority">CCL_PRIORITY</a></li>
<li class="toctree-l2"><a class="reference internal" href="env_variables.html#ccl-worker-count">CCL_WORKER_COUNT</a></li>
<li class="toctree-l2"><a class="reference internal" href="env_variables.html#ccl-worker-affinity">CCL_WORKER_AFFINITY</a></li>
<li class="toctree-l2"><a class="reference internal" href="env_variables.html#ccl-log-level">CCL_LOG_LEVEL</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Library API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api/initialization.html">Initialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/concepts.html">oneCCL Concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/concepts/communicator.html">Communicator</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/concepts/context.html">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/concepts/device.html">Device</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/concepts/event.html">Event</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/concepts/kvs.html">Key-value Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/concepts/stream.html">Stream</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api/operations.html">Communication operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/operations/datatypes.html">Datatypes</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/operations/collective-operations.html">Collective Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/operations/collective-operations/allgatherv.html">Allgatherv</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/operations/collective-operations/allreduce.html">Allreduce</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/operations/collective-operations/alltoall.html">Alltoall</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/operations/collective-operations/alltoallv.html">Alltoallv</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/operations/collective-operations/barrier.html">Barrier</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/operations/collective-operations/broadcast.html">Broadcast</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/operations/collective-operations/reduce.html">Reduce</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/operations/collective-operations/reduce-scatter.html">ReduceScatter</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/operations/collective-operations/sparse-allreduce.html">SparseAllreduce</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/operations/collective-operations.html#operation-attributes">Operation Attributes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Notices and Disclaimers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="legal.html">Notices and Disclaimers</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimization_notice.html">Optimization Notice</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">oneCCL Documentation (Beta)</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Unordered collectives support</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/unordered_collectives.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="unordered-collectives-support">
<h1>Unordered collectives support<a class="headerlink" href="#unordered-collectives-support" title="Permalink to this headline">¶</a></h1>
<p>Some deep learning frameworks deploy local scheduling approach for the graph of operations,
which may result in different ordering of collective operations across different processes.
When using communication middleware that requires the same order of collective calls across different ranks, such scenarios may result in hangs or data corruption.
This requires complicated coordination logic to maintain the same ordering.</p>
<p>In contrast, oneCCL provides a mechanism to arrange execution of collective operations in accordance with the user-defined string identifier. To set an identifier, use <code class="docutils literal notranslate"><span class="pre">match_id</span></code> field in operation attribute.</p>
<p>Unordered collectives’ execution is coordinated by the zero-id rank (root rank). When root rank receives a user request with a non-empty <code class="docutils literal notranslate"><span class="pre">match_id</span></code> for the first time,
it broadcasts information about the user identifier to all other ranks and assigns an internal oneCCL identifier that will later be used with all following operations with the same <code class="docutils literal notranslate"><span class="pre">match_id</span></code>.</p>
<p>When a non-root rank receives a user request with a non-empty <code class="docutils literal notranslate"><span class="pre">match_id</span></code> for the first time, it postpones operation execution until it receives a message from the root rank.
Once the message is received, the rank creates an internal oneCCL identifier that will be used for all following operations with the same <code class="docutils literal notranslate"><span class="pre">match_id</span></code>.</p>
<p>Unordered collectives are controlled by <a class="reference internal" href="env_variables.html#ccl-unordered-coll"><span class="std std-ref">CCL_UNORDERED_COLL</span></a>.</p>
<a class="reference internal image-reference" href="_images/unordered_coll.png"><img alt="_images/unordered_coll.png" src="_images/unordered_coll.png" style="width: 800px;" /></a>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sparse_collectives.html" class="btn btn-neutral float-right" title="Sparse collective operations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="operation_fusion.html" class="btn btn-neutral float-left" title="Fusion of Communication Operations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019–2020

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
<br>
<div>
  <p>
      For more complete information about compiler optimizations, see our <a href="optimization_notice.html">Optimization Notice</a>.
  </p>  
</div>


</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>